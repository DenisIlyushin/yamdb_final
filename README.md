# YaMDb

Проект собирает отзывы пользователей на различные произведения.

#### Учебный проект Я.Практикума. 
##### Когорта Python.7+, группа 3

___

![example workflow](https://github.com/DenisIlyushin/yamdb_final/actions/workflows/yamdb_workflow.yaml/badge.svg)

## Технологии
- Python v3.7
- Django v2.2.16
- Django filter v.21.1
- DRF (Django REST framework) v3.12.4
- DFR SimpleJWT v.1.0
- Gunicorn v.20.0.4
- Docker v.20.10.14
- nginx v.1.21.3
- PostgreSQL v.13.0

## Описание проекта

Проект YaMDb собирает отзывы (Review) пользователей на произведения (Titles). 
Произведения делятся на категории: «Книги», «Фильмы», «Музыка». Список категорий 
(Category) может быть расширен администратором (например, можно добавить категорию 
«Изобразительное искусство» или «Ювелирка»).

Сами произведения в YaMDb не хранятся, здесь нельзя посмотреть фильм или послушать музыку.

В каждой категории есть произведения: книги, фильмы или музыка. Например, 
в категории «Книги» могут быть произведения «Винни-Пух и все-все-все» 
и «Марсианские хроники», а в категории «Музыка» — песня «Давеча» группы «Насекомые» 
и вторая сюита Баха.

Произведению может быть присвоен жанр (Genre) из списка предустановленных 
(например, «Сказка», «Рок» или «Артхаус»). Новые жанры может создавать только 
администратор.

Благодарные или возмущённые пользователи оставляют к произведениям текстовые 
отзывы (Review) и ставят произведению оценку в диапазоне от одного до десяти 
(целое число); из пользовательских оценок формируется усреднённая оценка 
произведения — рейтинг (целое число). На одно произведение пользователь может 
оставить только один отзыв.

## Установка и запуск проекта на локальном компьютере

1. Клонируйте директорий и перейдите в корневую папку проекта:
```bash
git clone https://github.com/DenisIlyushin/yamdb_final.git
cd api_yamdb
```
2. Создайте и активируйте виртуальное окружение:
- Для Win10:
```bash
python -m venv env
source ./venv/bin/activate
python -m pip install --upgrade pip
```
- Для Ubuntu
```bash
python -m venv env
source venv/bin/activate
python -m pip install --upgrade pip
```
3. Обновите pip и установите зависимости в виртуальное окружение:
```bash
python -m pip install --upgrade pip
pip install -r requirements.txt
```

4. Выполните миграции:
```bash
python manage.py migrate
```

5. (опционально) Наполните базу данных тестовыми данными:
```bash
python manage.py import_csv
```

6. Застите проект:
```bash
python manage.py runserver
```

## Модель пользователей проекта
- **Аноним** — может просматривать описания произведений, читать отзывы и комментарии.
- **Аутентифицированный пользователь (`user`)** — может читать всё, как и Аноним, 
может публиковать отзывы и ставить оценки произведениям (фильмам/книгам/песенкам), 
может комментировать отзывы; может редактировать и удалять свои отзывы и комментарии, 
редактировать свои оценки произведений. Эта роль присваивается по умолчанию каждому 
новому пользователю.
- **Модератор (`moderator`)** — те же права, что и у Аутентифицированного пользователя, 
плюс право удалять и редактировать любые отзывы и комментарии.
- **Администратор (`admin`)** — полные права на управление всем контентом проекта. 
Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям.
- **Суперюзер Django** должен всегда обладать правами администратора, пользователя 
с правами admin. Даже если изменить пользовательскую роль суперюзера — это не лишит его 
прав администратора. Суперюзер — всегда администратор, но администратор — не обязательно 
суперюзер.

## Ресурсы проекта
- Ресурс **auth**: аутентификация.
- Ресурс **users**: пользователи.
- Ресурс **titles**: произведения, к которым пишут отзывы (определённый фильм, книга или песенка).
- Ресурс **categories**: категории (типы) произведений («Фильмы», «Книги», «Музыка»).
- Ресурс **genres**: жанры произведений. Одно произведение может быть привязано к нескольким жанрам.
- Ресурс **reviews**: отзывы на произведения. Отзыв привязан к определённому произведению.
- Ресурс **comments**: комментарии к отзывам. Комментарий привязан к определённому отзыву.

Каждый ресурс описан в документации: указаны эндпоинты (адреса, по которым можно 
сделать запрос), разрешённые типы запросов, права доступа и дополнительные параметры, 
если это необходимо.

Для доступа к документации проекта запустите проект согласно инструкции и пройдите 
[по ссылке](http://127.0.0.1:8000/redoc/).

## Запуск проекта в Docker
Для автоматизации запуска приложения установите на вашем компьютере или сервере Docker.

### Шаблон наполнения .env
Файл `.env` следует разместить в директории `./api_yamdb/`. 
Пример наполнения с комментариями приведет в файле `./api_yamdb/.env.example`

### Dockerfile для приложения Django
В файле конфигурации запуска многоконтейнерных приложений `infra/docker-compose.yaml` 
все уже сделано за вас, однако при желании сделать самостоятельную сборку приложения 
**api_yamdb**, используя файл-конфигурации `.\api_yamdb\Dockerfile`.
Находясь в директории `.\api_yamdb\` для сборки контейнера используйте команду:
```bash
docker build -t yamdb .
```

### Последовательность запуска приложения
1. **Сборка контейнера**.
Находясь в папке `.\infra\` выполните следующую команду для сборки и запуска контейнера
```bash
docker-compose up -d --build
```
2. **Запуск приложения api_yamdb**.
После успешной сбоки контейнеров выполните следующие команды в терминале:
```bash
# Выполнить миграции
docker-compose exec web python manage.py migrate
# Создаем суперппользователя
docker-compose exec web python manage.py createsuperuser
# Собираем статику со всего проекта
docker-compose exec web python manage.py collectstatic --no-input
# (опц.) Для резервного копирования данных из БД
docker-compose exec web python manage.py dumpdata > dump.json
# (опц.) Для занесения в БД демонстрационных данных
docker-compose exec web python manage.py import_csv
```
3. **Остановка и повторный запуск приложения api_yamdb**.
```bash
# Для остановки контейнеров
docker-compose down
# Для повторного запуска контейнеров
docker-compose up -d
```

### Восстановление данных из резервной копии
```bash
docker-compose exec web bash
python manage.py flush

python3 manage.py shell

from django.contrib.contenttypes.models import ContentType
ContentType.objects.all().delete()
quit()

python manage.py loaddata dump.json
```

## Авторы проекта
**Геогрий Щербин** ([okairon](https://github.com/okairon) ) писал часть, касающуюся 
управления пользователями (Auth и Users): систему регистрации и аутентификации, 
права доступа, работу с токеном, систему подтверждения через e-mail.

**Анастасия Верталь** ([nastyavertal](https://github.com/nastyavertal/)) писала часть, 
касающуюся категорий (Categories), жанров (Genres) и произведений (Titles): модели, 
представления и эндпойнты для них.

**Денис Илюшин** ([DenisIlyushin](https://github.com/DenisIlyushin/)) писал часть, 
касающуюся отзывов (Review) и комментариев (Comments): описывает модели, представления, 
настраивает эндпойнты, определяет права доступа для запросов. Выполнял функции тимлида.

Авторы помогали друг другу и получили массу опыта и удовольствия выполняя проект 
в одной команде!
